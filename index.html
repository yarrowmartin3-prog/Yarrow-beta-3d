<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Yarrow Assistant</title>
  <style>
    :root { color-scheme: light dark; }
    body { font-family: Arial, sans-serif; margin:0; padding:20px; text-align:center; background:#f5f5f5; }
    h1 { margin:10px 0 16px; }
    .avatar { width:110px; height:110px; border-radius:50%; object-fit:cover; background:#fff; box-shadow:0 2px 8px rgba(0,0,0,.15); }
    .row { display:flex; gap:10px; justify-content:center; align-items:center; margin:12px 0; flex-wrap:wrap; }
    button { padding:10px 14px; border-radius:10px; border:1px solid #bbb; background:#fff; }
    button.small { padding:8px 12px; }
    button.primary { background:#4caf50; color:#fff; border:0; }
    #voiceSelect { padding:8px; border-radius:8px; border:1px solid #bbb; }
    #capabilities { color:#555; margin-bottom:10px; }
    #output { margin:14px auto; max-width:640px; min-height:1.2em; }
  </style>
</head>
<body>
  <h1>ğŸŒ± Yarrow Assistant</h1>

  <!-- CompatibilitÃ© -->
  <p id="capabilities">Chargementâ€¦</p>

  <!-- Avatar + choix -->
  <img id="assistantAvatar" src="assistant-1.png" alt="Assistant" class="avatar">
  <div class="row">
    <button class="small" data-src="assistant-1.png">ğŸ™‚</button>
    <button class="small" data-src="assistant-2.png">ğŸ¤–</button>
    <button class="small" data-src="assistant-3.png">ğŸ§‘â€ğŸ”§</button>
  </div>

  <!-- Voix -->
  <div class="row">
    <label for="voiceSelect">Voix :</label>
    <select id="voiceSelect"><option>(chargement)</option></select>
    <button id="start-voice" class="primary">ğŸ¤ Parler</button>
  </div>

  <p id="output"></p>

  <script>
    // -------- CONFIG --------
    const API_BASE = "https://yarrow-ai-server.vercel.app"; // â† remplace si ton URL Vercel est diffÃ©rente

    // -------- UTIL --------
    const $ = id => document.getElementById(id);
    const setText = (el, t) => el && (el.textContent = t);

    // -------- SELECTEURS --------
    const startBtn = $("start-voice");
    const output = $("output");
    const capabilities = $("capabilities");
    const voiceSelect = $("voiceSelect");
    const avatarImg = $("assistantAvatar");

    // -------- COMPATIBILITÃ‰ --------
    const supportsRecognition = !!(window.SpeechRecognition || window.webkitSpeechRecognition);
    const supportsSynthesis = "speechSynthesis" in window;

    if (supportsRecognition && supportsSynthesis) {
      setText(capabilities, "âœ… Compatible : Ã©coute et voix disponibles");
    } else if (supportsRecognition) {
      setText(capabilities, "âš ï¸ Ã‰coute seulement, pas de voix");
    } else if (supportsSynthesis) {
      setText(capabilities, "âš ï¸ Voix seulement, pas dâ€™Ã©coute (utilise Chrome Android pour le micro)");
    } else {
      setText(capabilities, "âŒ Pas compatible sur ce navigateur");
    }

    // -------- AVATARS --------
    document.querySelectorAll("button[data-src]").forEach(b=>{
      b.addEventListener("click", ()=> { avatarImg.src = b.getAttribute("data-src"); });
    });

    // -------- VOIX --------
    let voices = [];
    function loadVoices(){
      if (!supportsSynthesis) return;
      voices = speechSynthesis.getVoices();
      voiceSelect.innerHTML = "";
      if (!voices.length) {
        const o = document.createElement("option"); o.text = "(aucune voix trouvÃ©e)"; voiceSelect.add(o);
        return;
      }
      voices
        .sort((a,b)=>(b.lang.startsWith("fr")-a.lang.startsWith("fr"))||a.name.localeCompare(b.name))
        .forEach(v=>{
          const o = document.createElement("option");
          o.value = v.name; o.text = `${v.name} (${v.lang})`;
          voiceSelect.add(o);
        });
      const fr = voices.find(v=>v.lang.startsWith("fr"));
      if (fr) voiceSelect.value = fr.name;
    }
    if (supportsSynthesis){ loadVoices(); speechSynthesis.onvoiceschanged = loadVoices; }

    // -------- RECONNA
